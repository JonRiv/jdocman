<!DOCTYPE html>
<html manifest="manifest.appcache">
  <head>
    <title>Task Manager</title>
    <link rel="shortcut icon" href="favicon.png" type="image/png"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="modules/themes/taskman-theme.css">
    <link rel="stylesheet" href="modules/themes/jquery.mobile.icons.min.css">
    <link rel="stylesheet" href="lib/jqm/jquery.mobile.structure-1.4.0.min.css">
    <link rel="stylesheet" href="modules/taskman.css">
    <link rel="stylesheet" href="modules/collapsible-listview.css">
    <link rel="stylesheet" href="lib/jquery.mobile.datepicker/jquery.mobile.datepicker.css">
    <link rel="stylesheet" href="lib/jquery-te/jquery-te-1.4.0.css">
  </head>
  <body class="initHandler">
    <script src="lib/jquery/jquery-1.10.2.js"></script>
    <script src="lib/jquery.mobile.datepicker/jquery.ui.datepicker.js"></script>
    <script src="lib/jio/sha256.amd.js"></script>
    <script src="lib/jio/rsvp-custom.js"></script>
    <script src="lib/jio/jio.js"></script>
    <script src="lib/jio/complex_queries.js"></script>
    <script src="lib/jio/storage/localstorage.js"></script>
    <script src="lib/jio/storage/davstorage.js"></script>
    <script src="lib/moment/moment-2.5.0.js"></script>
    <script src="lib/jio/jiodate.js"></script>
    <script src="lib/js-logger/logger.js"></script>
    <script src="lib/handlebars/handlebars-v1.1.2.js"></script>
    <script src="lib/i18next/i18next-1.7.1.min.js"></script>
    <script src="modules/task-util.js"></script>
    <script src="modules/task-data.js"></script>
    <script src="modules/taskman.js"></script>
    <script src="lib/jqm/jquery.mobile-1.4.0.min.js"></script>
    <script src="lib/jquery.mobile.datepicker/jquery.mobile.datepicker.js"></script>
    <script src="lib/jquery-te/jquery-te-1.4.0.min.js"></script>

    <div id="buildbox">

      <input type="button" value="Build" />
      <textarea id="minified_code"></textarea>

      <script>
      (function injectuglify() {
        var scripts = document.getElementsByTagName('script');
        var current = scripts[scripts.length-1];
        var uglify = document.createElement('script');
        uglify.setAttribute('src', 'lib/uglifyjs/uglifyweb.js');
        current.parentNode.insertBefore(uglify, current.nextSibling);
      }());

      jQuery(function ($) {
        var js = $('script[src]').get();
        var css = $('link[rel=stylesheet]').get();
        var deferred = js.map(function(element) {
          var url = element.getAttribute('src');
          return $.get(url);
        });
        $.when.apply($, deferred).then(function (stuff) {
          console.log(stuff);
          debugger;
        }, function (e) {
          console.log('ajax call failed');
          debugger;
        });
      });

//          , function(source_code) {
//            var min = uglify(source_code);
//            if (min.length >= source_code.length * 0.9) {
//              console.log('Unchanged:', url);
//              return source_code;
//            }
//            console.log('Minified:', url);


      </script>

    </div>
  </body>
</html>
